(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/cmsDetail"],{"0589":function(e,t,n){"use strict";n.r(t);var o=n("52be"),i=n("debe");for(var s in i)"default"!==s&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n("c17d"),n("35a5");var a,c=n("f0c5"),u=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,"df61e618",null,!1,o["a"],a);t["default"]=u.exports},"22a6":function(e,t,n){},"260e":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i=n("71ae"),s=a(n("c4a2"));function a(e){return e&&e.__esModule?e:{default:e}}var c={data:function(){return{test:"../../static/image/banner2.png",essayList:"",cmsNewslist:[],commentList:[],status:"more",page:1,lastPage:0,popType:"bottom",cmsId:"",guanzhu:0,userInfo:"",focusPop:!1}},onLoad:function(t){o=this,o.cmsId=t.id,o.getCmsDetail(t.id),o.initValidate();var n=e.getStorageSync("userInfo");o.userInfo=n},onReachBottom:function(){if(console.log(o.lastPage),console.log(o.page),console.log(o.lastPage>=o.page),o.lastPage>=o.page)return o.status="loading",void o.getCommentList(o.cmsId,o.page);o.status="noMore"},methods:{getCmsDetail:function(e){(0,i.getCmsDetail)(e).then((function(t){console.log("getCmsDetail",t),o.essayList=t.data[0],o.getCmsDetailList(e),o.getCommentList(e,1)})).catch((function(e){o.showToast(e.text),console.log(e)}))},getCmsDetailList:function(e){(0,i.getCmsDetailList)(e).then((function(e){console.log("getCmsDetailList",e);var t=e.data;t.map((function(e,t){if(e.plato_id=o.newGuid(),e.nimages_type>1){var n=e.nimages.split(",");e.nimages=n}})),o.cmsNewslist=t})).catch((function(e){o.showToast(e.text),console.log(e)}))},getCommentList:function(t,n){(0,i.getCommentList)(t,n).then((function(t){console.log("getCommentList",t);var i=t.data;i.data.map((function(e,t){e.plato_id=o.newGuid()})),o.lastPage=i.last_page,1==n&&(o.commentList=[]),o.commentList=o.commentList.concat(i.data),e.stopPullDownRefresh(),o.page++,0!=i.length&&n!=i.last_page?o.status="more":o.status="noMore"})).catch((function(e){o.showToast(e.text),console.log(e)}))},commentAdd:function(t){(0,i.commentAdd)(t).then((function(t){console.log("commentAdd",t),200==t.data.statusCode?e.showToast({title:"评论成功，进入审核通道",icon:"none",duration:2e3,success:function(){setTimeout((function(){o.cancel()}),2e3)}}):o.showToast(t.data.message)})).catch((function(e){o.showToast(e.text),console.log(e)}))},commentSubmit:function(e){console.log(e);var t=e.detail.value;if(!o.WxValidate.checkForm(t)){var n=o.WxValidate.errorList[0];return console.log(n),void o.showToast(n.msg)}o.commentAdd(t)},changeLikes:function(t){(0,i.changeLikes)(t).then((function(n){if(console.log("changeLikes",n),console.log(t),200==n.data.statusCode){if(3==t.type)o.$set(o.essayList,"is_like",1);else{o.$set(o.commentList[t.index],"is_like",1);var i=o.commentList[t.index].like_count;i++,o.$set(o.commentList[t.index],"like_count",i)}e.showToast({title:"",icon:"success",duration:2e3,success:function(){}})}else o.showToast(n.data.message)})).catch((function(e){o.showToast(e.text),console.log(e)}))},like:function(e,t,n){if(console.log(e),console.log(t),console.log(n),"field"==e){var i={news_id:o.cmsId,type:"likes",user_id:o.userInfo.user_id};o.changeLikes(i)}else{var s={news_id:t.comment_id,type:"likes",user_id:o.userInfo.user_id,index:n};o.changeLikes(s)}},newGuid:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return(e()+e()+"-"+e()+"-4"+e().substr(0,3)+"-"+e()+"-"+e()+e()+e()).toUpperCase()},initValidate:function(e){var t={content:{required:!0},news_id:{required:!0},reply_id:{required:!0},user_id:{required:!0},user_name:{required:!0},user_photo:{required:!0}},n={content:{required:"评论框不能为空"},news_id:{required:"未知错误，请刷新页面重试"},reply_id:{required:"未知错误，请刷新页面重试"},user_id:{required:"未知错误，请刷新页面重试"},user_name:{required:"未知错误，请刷新页面重试"},user_photo:{required:"未知错误，请刷新页面重试"}};o.WxValidate=new s.default(t,n)},togglePopup:function(t){console.log(t),o.userInfo?this.$refs.areapopup.open():e.navigateTo({url:"../login/login"})},cancel:function(){o.$refs.areapopup.close()},change:function(e){console.log(e),console.log("是否打开:"+e.show),o.$nextTick((function(){o.focusPop=e.show}))},guanZhu:function(){o.guanzhu=1},goCmsdetail:function(t){e.redirectTo({url:"./cmsDetail?id="+t})},back:function(){e.navigateBack()},showToast:function(t){e.showToast({title:t,icon:"none",mask:!0,duration:2e3})}},filters:{formatRichText:function(e){console.log(e);var t=e.replace(/<img[^>]*>/gi,(function(e,t){return e=e.replace(/style="[^"]+"/gi,"").replace(/style='[^']+'/gi,""),e=e.replace(/width="[^"]+"/gi,"").replace(/width='[^']+'/gi,""),e=e.replace(/height="[^"]+"/gi,"").replace(/height='[^']+'/gi,""),e}));return t=t.replace(/style="[^"]+"/gi,(function(e,t){return e=e.replace(/width:[^;]+;/gi,"max-width:100%;").replace(/width:[^;]+;/gi,"max-width:100%;"),e})),t=t.replace(/<br[^>]*\/>/gi,""),t=t.replace(/\<img/gi,'<img style="max-width:100%;height:auto;display:inline-block;margin:10rpx auto;"'),t}}};t.default=c}).call(this,n("543d")["default"])},"35a5":function(e,t,n){"use strict";var o=n("e8ca"),i=n.n(o);i.a},"52be":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}));var o={uniNavBar:function(){return n.e("components/uni-nav-bar/uni-nav-bar").then(n.bind(null,"6203"))},uniLoadMore:function(){return n.e("components/uni-load-more/uni-load-more").then(n.bind(null,"18f3"))},uniPopup:function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-popup/uni-popup")]).then(n.bind(null,"0043"))}},i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.essayList&&e.essayList.nsendtime?e._f("showTime")(e.essayList.nsendtime):null),o=e.essayList&&e.essayList.ncontent?e._f("formatRichText")(e.essayList.ncontent):null,i=e.essayList?e.__map(e.cmsNewslist,(function(t,n){var o=e.__get_orig(t),i=e._f("showTime")(t.nsendtime);return{$orig:o,f2:i}})):null;e.$mp.data=Object.assign({},{$root:{f0:n,f1:o,l0:i}})},s=[]},c17d:function(e,t,n){"use strict";var o=n("22a6"),i=n.n(o);i.a},cc24:function(e,t,n){"use strict";(function(e){n("61ae");o(n("66fd"));var t=o(n("0589"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},debe:function(e,t,n){"use strict";n.r(t);var o=n("260e"),i=n.n(o);for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);t["default"]=i.a},e8ca:function(e,t,n){}},[["cc24","common/runtime","common/vendor"]]]);